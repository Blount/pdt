--TEST--
Bug 514864 - syntax coloring problem with nested nowdoc and heredoc sections
--FILE--
<?php
<<<DOC
{$a(<<<'NESTED'
        $a
        {$a(<<<NESTED
        $a
        NESTED
    )}
    NESTED $a do
    )}
    $a
    DOC;
DOC;

<<<NESTED
    DOC;
    $a
    NESTED;

<<<'NESTED'
    $a
    {$a(<<<NESTED
    $a
    NESTED;
?>
--EXPECT--
PHP_TOKEN|<|ST_PHP_IN_SCRIPTING
PHP_TOKEN|?|ST_PHP_IN_SCRIPTING
PHP_LABEL|php|ST_PHP_IN_SCRIPTING
WHITESPACE|
|ST_PHP_IN_SCRIPTING
PHP_HEREDOC_START_TAG|<<<DOC
|ST_PHP_START_HEREDOC
PHP_CURLY_OPEN|{|ST_PHP_IN_SCRIPTING
PHP_VARIABLE|$a|ST_PHP_IN_SCRIPTING
PHP_TOKEN|(|ST_PHP_IN_SCRIPTING
PHP_NOWDOC_START_TAG|<<<'NESTED'
|ST_PHP_START_NOWDOC
PHP_CONSTANT_ENCAPSED_STRING|        $a
        {$a(<<<NESTED
        $a|ST_PHP_END_NOWDOC
PHP_NOWDOC_CLOSE_TAG|
        NESTED|ST_PHP_IN_SCRIPTING
WHITESPACE|
    |ST_PHP_IN_SCRIPTING
PHP_TOKEN|)|ST_PHP_IN_SCRIPTING
PHP_CURLY_CLOSE|}|ST_PHP_HEREDOC
PHP_ENCAPSED_AND_WHITESPACE|
    NESTED|ST_PHP_HEREDOC
PHP_ENCAPSED_AND_WHITESPACE| |ST_PHP_HEREDOC
PHP_VARIABLE|$a|ST_PHP_QUOTES_AFTER_VARIABLE
PHP_ENCAPSED_AND_WHITESPACE| do
    )}
    |ST_PHP_HEREDOC
PHP_VARIABLE|$a|ST_PHP_QUOTES_AFTER_VARIABLE
PHP_HEREDOC_CLOSE_TAG|
    DOC|ST_PHP_IN_SCRIPTING
PHP_SEMICOLON|;|ST_PHP_IN_SCRIPTING
WHITESPACE|
|ST_PHP_IN_SCRIPTING
PHP_LABEL|DOC|ST_PHP_IN_SCRIPTING
PHP_SEMICOLON|;|ST_PHP_IN_SCRIPTING
WHITESPACE|
|ST_PHP_IN_SCRIPTING
PHP_HEREDOC_START_TAG|<<<NESTED
|ST_PHP_START_HEREDOC
PHP_ENCAPSED_AND_WHITESPACE|    DOC|ST_PHP_START_HEREDOC
PHP_ENCAPSED_AND_WHITESPACE|;
    |ST_PHP_HEREDOC
PHP_VARIABLE|$a|ST_PHP_QUOTES_AFTER_VARIABLE
PHP_HEREDOC_CLOSE_TAG|
    NESTED|ST_PHP_IN_SCRIPTING
PHP_SEMICOLON|;|ST_PHP_IN_SCRIPTING
WHITESPACE|
|ST_PHP_IN_SCRIPTING
PHP_NOWDOC_START_TAG|<<<'NESTED'
|ST_PHP_START_NOWDOC
PHP_CONSTANT_ENCAPSED_STRING|    $a
    {$a(<<<NESTED
    $a|ST_PHP_END_NOWDOC
PHP_NOWDOC_CLOSE_TAG|
    NESTED|ST_PHP_IN_SCRIPTING
PHP_SEMICOLON|;|ST_PHP_IN_SCRIPTING
WHITESPACE|
|ST_PHP_IN_SCRIPTING
PHP_CLOSETAG|?>|ST_PHP_IN_SCRIPTING
