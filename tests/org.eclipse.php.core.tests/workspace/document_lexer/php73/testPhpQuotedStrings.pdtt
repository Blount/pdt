--TEST--
Bug 514572 - Do better variable detection, highlighting and renaming in quoted strings and heredoc sections
--FILE--
<?php
<<<DOC
    {$a(<<<'NESTED'
        ${a[$a[0]]} {$a[$a[$a[$a[0]]]]} ${a} ${a[0]}
        NESTED
    )}
    ${a[$a[0]]} {$a[$a[$a[$a[0]]]]} ${a} ${a[0]}
    DOC;

$a(<<<NESTED
    ${a[$a[0]]} {$a[$a[$a[$a[0]]]]} ${a} ${a[0]}
    NESTED
);

$a = 5;
echo "${a[$a[0]]} {$a[$a[$a[$a[0]]]]} ${a} ${a[0]}";
echo '${a[$a[0]]} {$a[$a[$a[$a[0]]]]} ${a} ${a[0]}';

function a()
{
    global $a;
    $a = 10;
    $b = ${a};
    echo "${a[$a[0]]} {$a[$a[$a[$a[0]]]]} ${a} ${a[0]}";
    echo `${a[$a[0]]} {$a[$a[$a[$a[0]]]]} ${a} ${a[0]}`;
}
?>
--EXPECT--
PHP_TOKEN|<|ST_PHP_IN_SCRIPTING
PHP_TOKEN|?|ST_PHP_IN_SCRIPTING
PHP_LABEL|php|ST_PHP_IN_SCRIPTING
WHITESPACE|
|ST_PHP_IN_SCRIPTING
PHP_HEREDOC_START_TAG|<<<DOC
|ST_PHP_START_HEREDOC
PHP_ENCAPSED_AND_WHITESPACE|    |ST_PHP_HEREDOC
PHP_CURLY_OPEN|{|ST_PHP_IN_SCRIPTING
PHP_VARIABLE|$a|ST_PHP_IN_SCRIPTING
PHP_TOKEN|(|ST_PHP_IN_SCRIPTING
PHP_NOWDOC_START_TAG|<<<'NESTED'
|ST_PHP_START_NOWDOC
PHP_CONSTANT_ENCAPSED_STRING|        ${a[$a[0]]} {$a[$a[$a[$a[0]]]]} ${a} ${a[0]}|ST_PHP_END_NOWDOC
PHP_NOWDOC_CLOSE_TAG|
        NESTED|ST_PHP_IN_SCRIPTING
WHITESPACE|
    |ST_PHP_IN_SCRIPTING
PHP_TOKEN|)|ST_PHP_IN_SCRIPTING
PHP_CURLY_CLOSE|}|ST_PHP_HEREDOC
PHP_ENCAPSED_AND_WHITESPACE|
    |ST_PHP_HEREDOC
PHP_TOKEN|$|ST_PHP_DOLLAR_CURLY_OPEN
PHP_CURLY_OPEN|{|ST_PHP_DOLLAR_CURLY_OPEN
PHP_ENCAPSED_VARIABLE|a|ST_PHP_IN_SCRIPTING
PHP_TOKEN|[|ST_PHP_IN_SCRIPTING
PHP_VARIABLE|$a|ST_PHP_IN_SCRIPTING
PHP_TOKEN|[|ST_PHP_IN_SCRIPTING
PHP_NUMBER|0|ST_PHP_IN_SCRIPTING
PHP_TOKEN|]|ST_PHP_IN_SCRIPTING
PHP_TOKEN|]|ST_PHP_IN_SCRIPTING
PHP_CURLY_CLOSE|}|ST_PHP_HEREDOC
PHP_ENCAPSED_AND_WHITESPACE| |ST_PHP_HEREDOC
PHP_CURLY_OPEN|{|ST_PHP_IN_SCRIPTING
PHP_VARIABLE|$a|ST_PHP_IN_SCRIPTING
PHP_TOKEN|[|ST_PHP_IN_SCRIPTING
PHP_VARIABLE|$a|ST_PHP_IN_SCRIPTING
PHP_TOKEN|[|ST_PHP_IN_SCRIPTING
PHP_VARIABLE|$a|ST_PHP_IN_SCRIPTING
PHP_TOKEN|[|ST_PHP_IN_SCRIPTING
PHP_VARIABLE|$a|ST_PHP_IN_SCRIPTING
PHP_TOKEN|[|ST_PHP_IN_SCRIPTING
PHP_NUMBER|0|ST_PHP_IN_SCRIPTING
PHP_TOKEN|]|ST_PHP_IN_SCRIPTING
PHP_TOKEN|]|ST_PHP_IN_SCRIPTING
PHP_TOKEN|]|ST_PHP_IN_SCRIPTING
PHP_TOKEN|]|ST_PHP_IN_SCRIPTING
PHP_CURLY_CLOSE|}|ST_PHP_HEREDOC
PHP_ENCAPSED_AND_WHITESPACE| |ST_PHP_HEREDOC
PHP_TOKEN|$|ST_PHP_DOLLAR_CURLY_OPEN
PHP_CURLY_OPEN|{|ST_PHP_DOLLAR_CURLY_OPEN
PHP_ENCAPSED_VARIABLE|a|ST_PHP_IN_SCRIPTING
PHP_CURLY_CLOSE|}|ST_PHP_HEREDOC
PHP_ENCAPSED_AND_WHITESPACE| |ST_PHP_HEREDOC
PHP_TOKEN|$|ST_PHP_DOLLAR_CURLY_OPEN
PHP_CURLY_OPEN|{|ST_PHP_DOLLAR_CURLY_OPEN
PHP_ENCAPSED_VARIABLE|a|ST_PHP_IN_SCRIPTING
PHP_TOKEN|[|ST_PHP_IN_SCRIPTING
PHP_NUMBER|0|ST_PHP_IN_SCRIPTING
PHP_TOKEN|]|ST_PHP_IN_SCRIPTING
PHP_CURLY_CLOSE|}|ST_PHP_HEREDOC
PHP_HEREDOC_CLOSE_TAG|
    DOC|ST_PHP_IN_SCRIPTING
PHP_SEMICOLON|;|ST_PHP_IN_SCRIPTING
WHITESPACE|
|ST_PHP_IN_SCRIPTING
PHP_VARIABLE|$a|ST_PHP_IN_SCRIPTING
PHP_TOKEN|(|ST_PHP_IN_SCRIPTING
PHP_HEREDOC_START_TAG|<<<NESTED
|ST_PHP_START_HEREDOC
PHP_ENCAPSED_AND_WHITESPACE|    |ST_PHP_HEREDOC
PHP_TOKEN|$|ST_PHP_DOLLAR_CURLY_OPEN
PHP_CURLY_OPEN|{|ST_PHP_DOLLAR_CURLY_OPEN
PHP_ENCAPSED_VARIABLE|a|ST_PHP_IN_SCRIPTING
PHP_TOKEN|[|ST_PHP_IN_SCRIPTING
PHP_VARIABLE|$a|ST_PHP_IN_SCRIPTING
PHP_TOKEN|[|ST_PHP_IN_SCRIPTING
PHP_NUMBER|0|ST_PHP_IN_SCRIPTING
PHP_TOKEN|]|ST_PHP_IN_SCRIPTING
PHP_TOKEN|]|ST_PHP_IN_SCRIPTING
PHP_CURLY_CLOSE|}|ST_PHP_HEREDOC
PHP_ENCAPSED_AND_WHITESPACE| |ST_PHP_HEREDOC
PHP_CURLY_OPEN|{|ST_PHP_IN_SCRIPTING
PHP_VARIABLE|$a|ST_PHP_IN_SCRIPTING
PHP_TOKEN|[|ST_PHP_IN_SCRIPTING
PHP_VARIABLE|$a|ST_PHP_IN_SCRIPTING
PHP_TOKEN|[|ST_PHP_IN_SCRIPTING
PHP_VARIABLE|$a|ST_PHP_IN_SCRIPTING
PHP_TOKEN|[|ST_PHP_IN_SCRIPTING
PHP_VARIABLE|$a|ST_PHP_IN_SCRIPTING
PHP_TOKEN|[|ST_PHP_IN_SCRIPTING
PHP_NUMBER|0|ST_PHP_IN_SCRIPTING
PHP_TOKEN|]|ST_PHP_IN_SCRIPTING
PHP_TOKEN|]|ST_PHP_IN_SCRIPTING
PHP_TOKEN|]|ST_PHP_IN_SCRIPTING
PHP_TOKEN|]|ST_PHP_IN_SCRIPTING
PHP_CURLY_CLOSE|}|ST_PHP_HEREDOC
PHP_ENCAPSED_AND_WHITESPACE| |ST_PHP_HEREDOC
PHP_TOKEN|$|ST_PHP_DOLLAR_CURLY_OPEN
PHP_CURLY_OPEN|{|ST_PHP_DOLLAR_CURLY_OPEN
PHP_ENCAPSED_VARIABLE|a|ST_PHP_IN_SCRIPTING
PHP_CURLY_CLOSE|}|ST_PHP_HEREDOC
PHP_ENCAPSED_AND_WHITESPACE| |ST_PHP_HEREDOC
PHP_TOKEN|$|ST_PHP_DOLLAR_CURLY_OPEN
PHP_CURLY_OPEN|{|ST_PHP_DOLLAR_CURLY_OPEN
PHP_ENCAPSED_VARIABLE|a|ST_PHP_IN_SCRIPTING
PHP_TOKEN|[|ST_PHP_IN_SCRIPTING
PHP_NUMBER|0|ST_PHP_IN_SCRIPTING
PHP_TOKEN|]|ST_PHP_IN_SCRIPTING
PHP_CURLY_CLOSE|}|ST_PHP_HEREDOC
PHP_HEREDOC_CLOSE_TAG|
    NESTED|ST_PHP_IN_SCRIPTING
WHITESPACE|
|ST_PHP_IN_SCRIPTING
PHP_TOKEN|)|ST_PHP_IN_SCRIPTING
PHP_SEMICOLON|;|ST_PHP_IN_SCRIPTING
WHITESPACE|
|ST_PHP_IN_SCRIPTING
PHP_VARIABLE|$a|ST_PHP_IN_SCRIPTING
WHITESPACE| |ST_PHP_IN_SCRIPTING
PHP_TOKEN|=|ST_PHP_IN_SCRIPTING
WHITESPACE| |ST_PHP_IN_SCRIPTING
PHP_NUMBER|5|ST_PHP_IN_SCRIPTING
PHP_SEMICOLON|;|ST_PHP_IN_SCRIPTING
WHITESPACE|
|ST_PHP_IN_SCRIPTING
PHP_ECHO|echo|ST_PHP_IN_SCRIPTING
WHITESPACE| |ST_PHP_IN_SCRIPTING
PHP_CONSTANT_ENCAPSED_STRING|"|ST_PHP_DOUBLE_QUOTES
PHP_TOKEN|$|ST_PHP_DOLLAR_CURLY_OPEN
PHP_CURLY_OPEN|{|ST_PHP_DOLLAR_CURLY_OPEN
PHP_ENCAPSED_VARIABLE|a|ST_PHP_IN_SCRIPTING
PHP_TOKEN|[|ST_PHP_IN_SCRIPTING
PHP_VARIABLE|$a|ST_PHP_IN_SCRIPTING
PHP_TOKEN|[|ST_PHP_IN_SCRIPTING
PHP_NUMBER|0|ST_PHP_IN_SCRIPTING
PHP_TOKEN|]|ST_PHP_IN_SCRIPTING
PHP_TOKEN|]|ST_PHP_IN_SCRIPTING
PHP_CURLY_CLOSE|}|ST_PHP_DOUBLE_QUOTES
PHP_ENCAPSED_AND_WHITESPACE| |ST_PHP_DOUBLE_QUOTES
PHP_CURLY_OPEN|{|ST_PHP_IN_SCRIPTING
PHP_VARIABLE|$a|ST_PHP_IN_SCRIPTING
PHP_TOKEN|[|ST_PHP_IN_SCRIPTING
PHP_VARIABLE|$a|ST_PHP_IN_SCRIPTING
PHP_TOKEN|[|ST_PHP_IN_SCRIPTING
PHP_VARIABLE|$a|ST_PHP_IN_SCRIPTING
PHP_TOKEN|[|ST_PHP_IN_SCRIPTING
PHP_VARIABLE|$a|ST_PHP_IN_SCRIPTING
PHP_TOKEN|[|ST_PHP_IN_SCRIPTING
PHP_NUMBER|0|ST_PHP_IN_SCRIPTING
PHP_TOKEN|]|ST_PHP_IN_SCRIPTING
PHP_TOKEN|]|ST_PHP_IN_SCRIPTING
PHP_TOKEN|]|ST_PHP_IN_SCRIPTING
PHP_TOKEN|]|ST_PHP_IN_SCRIPTING
PHP_CURLY_CLOSE|}|ST_PHP_DOUBLE_QUOTES
PHP_ENCAPSED_AND_WHITESPACE| |ST_PHP_DOUBLE_QUOTES
PHP_TOKEN|$|ST_PHP_DOLLAR_CURLY_OPEN
PHP_CURLY_OPEN|{|ST_PHP_DOLLAR_CURLY_OPEN
PHP_ENCAPSED_VARIABLE|a|ST_PHP_IN_SCRIPTING
PHP_CURLY_CLOSE|}|ST_PHP_DOUBLE_QUOTES
PHP_ENCAPSED_AND_WHITESPACE| |ST_PHP_DOUBLE_QUOTES
PHP_TOKEN|$|ST_PHP_DOLLAR_CURLY_OPEN
PHP_CURLY_OPEN|{|ST_PHP_DOLLAR_CURLY_OPEN
PHP_ENCAPSED_VARIABLE|a|ST_PHP_IN_SCRIPTING
PHP_TOKEN|[|ST_PHP_IN_SCRIPTING
PHP_NUMBER|0|ST_PHP_IN_SCRIPTING
PHP_TOKEN|]|ST_PHP_IN_SCRIPTING
PHP_CURLY_CLOSE|}|ST_PHP_DOUBLE_QUOTES
PHP_CONSTANT_ENCAPSED_STRING|"|ST_PHP_IN_SCRIPTING
PHP_SEMICOLON|;|ST_PHP_IN_SCRIPTING
WHITESPACE|
|ST_PHP_IN_SCRIPTING
PHP_ECHO|echo|ST_PHP_IN_SCRIPTING
WHITESPACE| |ST_PHP_IN_SCRIPTING
PHP_CONSTANT_ENCAPSED_STRING|'${a[$a[0]]} {$a[$a[$a[$a[0]]]]} ${a} ${a[0]}'|ST_PHP_IN_SCRIPTING
PHP_SEMICOLON|;|ST_PHP_IN_SCRIPTING
WHITESPACE|
|ST_PHP_IN_SCRIPTING
PHP_FUNCTION|function|ST_PHP_IDENTIFIER
WHITESPACE| |ST_PHP_IDENTIFIER
PHP_LABEL|a|ST_PHP_IN_SCRIPTING
PHP_TOKEN|(|ST_PHP_IN_SCRIPTING
PHP_TOKEN|)|ST_PHP_IN_SCRIPTING
WHITESPACE|
|ST_PHP_IN_SCRIPTING
PHP_CURLY_OPEN|{
    |ST_PHP_IN_SCRIPTING
PHP_GLOBAL|global|ST_PHP_IN_SCRIPTING
WHITESPACE| |ST_PHP_IN_SCRIPTING
PHP_VARIABLE|$a|ST_PHP_IN_SCRIPTING
PHP_SEMICOLON|;|ST_PHP_IN_SCRIPTING
WHITESPACE|
    |ST_PHP_IN_SCRIPTING
PHP_VARIABLE|$a|ST_PHP_IN_SCRIPTING
WHITESPACE| |ST_PHP_IN_SCRIPTING
PHP_TOKEN|=|ST_PHP_IN_SCRIPTING
WHITESPACE| |ST_PHP_IN_SCRIPTING
PHP_NUMBER|10|ST_PHP_IN_SCRIPTING
PHP_SEMICOLON|;|ST_PHP_IN_SCRIPTING
WHITESPACE|
    |ST_PHP_IN_SCRIPTING
PHP_VARIABLE|$b|ST_PHP_IN_SCRIPTING
WHITESPACE| |ST_PHP_IN_SCRIPTING
PHP_TOKEN|=|ST_PHP_IN_SCRIPTING
WHITESPACE| |ST_PHP_IN_SCRIPTING
PHP_TOKEN|$|ST_PHP_IN_SCRIPTING
PHP_CURLY_OPEN|{|ST_PHP_IN_SCRIPTING
PHP_LABEL|a|ST_PHP_IN_SCRIPTING
PHP_CURLY_CLOSE|}|ST_PHP_IN_SCRIPTING
PHP_SEMICOLON|;|ST_PHP_IN_SCRIPTING
WHITESPACE|
    |ST_PHP_IN_SCRIPTING
PHP_ECHO|echo|ST_PHP_IN_SCRIPTING
WHITESPACE| |ST_PHP_IN_SCRIPTING
PHP_CONSTANT_ENCAPSED_STRING|"|ST_PHP_DOUBLE_QUOTES
PHP_TOKEN|$|ST_PHP_DOLLAR_CURLY_OPEN
PHP_CURLY_OPEN|{|ST_PHP_DOLLAR_CURLY_OPEN
PHP_ENCAPSED_VARIABLE|a|ST_PHP_IN_SCRIPTING
PHP_TOKEN|[|ST_PHP_IN_SCRIPTING
PHP_VARIABLE|$a|ST_PHP_IN_SCRIPTING
PHP_TOKEN|[|ST_PHP_IN_SCRIPTING
PHP_NUMBER|0|ST_PHP_IN_SCRIPTING
PHP_TOKEN|]|ST_PHP_IN_SCRIPTING
PHP_TOKEN|]|ST_PHP_IN_SCRIPTING
PHP_CURLY_CLOSE|}|ST_PHP_DOUBLE_QUOTES
PHP_ENCAPSED_AND_WHITESPACE| |ST_PHP_DOUBLE_QUOTES
PHP_CURLY_OPEN|{|ST_PHP_IN_SCRIPTING
PHP_VARIABLE|$a|ST_PHP_IN_SCRIPTING
PHP_TOKEN|[|ST_PHP_IN_SCRIPTING
PHP_VARIABLE|$a|ST_PHP_IN_SCRIPTING
PHP_TOKEN|[|ST_PHP_IN_SCRIPTING
PHP_VARIABLE|$a|ST_PHP_IN_SCRIPTING
PHP_TOKEN|[|ST_PHP_IN_SCRIPTING
PHP_VARIABLE|$a|ST_PHP_IN_SCRIPTING
PHP_TOKEN|[|ST_PHP_IN_SCRIPTING
PHP_NUMBER|0|ST_PHP_IN_SCRIPTING
PHP_TOKEN|]|ST_PHP_IN_SCRIPTING
PHP_TOKEN|]|ST_PHP_IN_SCRIPTING
PHP_TOKEN|]|ST_PHP_IN_SCRIPTING
PHP_TOKEN|]|ST_PHP_IN_SCRIPTING
PHP_CURLY_CLOSE|}|ST_PHP_DOUBLE_QUOTES
PHP_ENCAPSED_AND_WHITESPACE| |ST_PHP_DOUBLE_QUOTES
PHP_TOKEN|$|ST_PHP_DOLLAR_CURLY_OPEN
PHP_CURLY_OPEN|{|ST_PHP_DOLLAR_CURLY_OPEN
PHP_ENCAPSED_VARIABLE|a|ST_PHP_IN_SCRIPTING
PHP_CURLY_CLOSE|}|ST_PHP_DOUBLE_QUOTES
PHP_ENCAPSED_AND_WHITESPACE| |ST_PHP_DOUBLE_QUOTES
PHP_TOKEN|$|ST_PHP_DOLLAR_CURLY_OPEN
PHP_CURLY_OPEN|{|ST_PHP_DOLLAR_CURLY_OPEN
PHP_ENCAPSED_VARIABLE|a|ST_PHP_IN_SCRIPTING
PHP_TOKEN|[|ST_PHP_IN_SCRIPTING
PHP_NUMBER|0|ST_PHP_IN_SCRIPTING
PHP_TOKEN|]|ST_PHP_IN_SCRIPTING
PHP_CURLY_CLOSE|}|ST_PHP_DOUBLE_QUOTES
PHP_CONSTANT_ENCAPSED_STRING|"|ST_PHP_IN_SCRIPTING
PHP_SEMICOLON|;|ST_PHP_IN_SCRIPTING
WHITESPACE|
    |ST_PHP_IN_SCRIPTING
PHP_ECHO|echo|ST_PHP_IN_SCRIPTING
WHITESPACE| |ST_PHP_IN_SCRIPTING
PHP_CONSTANT_ENCAPSED_STRING|`|ST_PHP_BACKQUOTE
PHP_TOKEN|$|ST_PHP_DOLLAR_CURLY_OPEN
PHP_CURLY_OPEN|{|ST_PHP_DOLLAR_CURLY_OPEN
PHP_ENCAPSED_VARIABLE|a|ST_PHP_IN_SCRIPTING
PHP_TOKEN|[|ST_PHP_IN_SCRIPTING
PHP_VARIABLE|$a|ST_PHP_IN_SCRIPTING
PHP_TOKEN|[|ST_PHP_IN_SCRIPTING
PHP_NUMBER|0|ST_PHP_IN_SCRIPTING
PHP_TOKEN|]|ST_PHP_IN_SCRIPTING
PHP_TOKEN|]|ST_PHP_IN_SCRIPTING
PHP_CURLY_CLOSE|}|ST_PHP_BACKQUOTE
PHP_ENCAPSED_AND_WHITESPACE| |ST_PHP_BACKQUOTE
PHP_CURLY_OPEN|{|ST_PHP_IN_SCRIPTING
PHP_VARIABLE|$a|ST_PHP_IN_SCRIPTING
PHP_TOKEN|[|ST_PHP_IN_SCRIPTING
PHP_VARIABLE|$a|ST_PHP_IN_SCRIPTING
PHP_TOKEN|[|ST_PHP_IN_SCRIPTING
PHP_VARIABLE|$a|ST_PHP_IN_SCRIPTING
PHP_TOKEN|[|ST_PHP_IN_SCRIPTING
PHP_VARIABLE|$a|ST_PHP_IN_SCRIPTING
PHP_TOKEN|[|ST_PHP_IN_SCRIPTING
PHP_NUMBER|0|ST_PHP_IN_SCRIPTING
PHP_TOKEN|]|ST_PHP_IN_SCRIPTING
PHP_TOKEN|]|ST_PHP_IN_SCRIPTING
PHP_TOKEN|]|ST_PHP_IN_SCRIPTING
PHP_TOKEN|]|ST_PHP_IN_SCRIPTING
PHP_CURLY_CLOSE|}|ST_PHP_BACKQUOTE
PHP_ENCAPSED_AND_WHITESPACE| |ST_PHP_BACKQUOTE
PHP_TOKEN|$|ST_PHP_DOLLAR_CURLY_OPEN
PHP_CURLY_OPEN|{|ST_PHP_DOLLAR_CURLY_OPEN
PHP_ENCAPSED_VARIABLE|a|ST_PHP_IN_SCRIPTING
PHP_CURLY_CLOSE|}|ST_PHP_BACKQUOTE
PHP_ENCAPSED_AND_WHITESPACE| |ST_PHP_BACKQUOTE
PHP_TOKEN|$|ST_PHP_DOLLAR_CURLY_OPEN
PHP_CURLY_OPEN|{|ST_PHP_DOLLAR_CURLY_OPEN
PHP_ENCAPSED_VARIABLE|a|ST_PHP_IN_SCRIPTING
PHP_TOKEN|[|ST_PHP_IN_SCRIPTING
PHP_NUMBER|0|ST_PHP_IN_SCRIPTING
PHP_TOKEN|]|ST_PHP_IN_SCRIPTING
PHP_CURLY_CLOSE|}|ST_PHP_BACKQUOTE
PHP_CONSTANT_ENCAPSED_STRING|`|ST_PHP_IN_SCRIPTING
PHP_SEMICOLON|;|ST_PHP_IN_SCRIPTING
WHITESPACE|
|ST_PHP_IN_SCRIPTING
PHP_CURLY_CLOSE|}
|ST_PHP_IN_SCRIPTING
PHP_CLOSETAG|?>|ST_PHP_IN_SCRIPTING
