<project name="Build specific targets and properties">
	<!-- <property name="baseline" value="/home/zhaozw/Desktop/eclipse" />
	<property name="profile" value="${buildDirectory}/${SDKZip}" />
	<property name="baseline" value="/home/zhaozw/Desktop/pdt-SDK-S201006090518.zip" />
	<property name="profile" value="/home/zhaozw/Desktop/pdt-SDK-N201010231504.zip" />
	<property name="baseline" value="${buildDir}/${buildLabel}/${masterZip}" />
	<property name="baseline" value="/home/data/httpd/download.eclipse.org/tools/pdt/downloads/drops/2.2.0/S201006090518/pdt-SDK-S201006090518.zip" />
	<property name="profile" value="${buildDirectory}/${buildLabel}/${masterZip}" /> -->
	<property name="baseline" value="/home/data/httpd/download.eclipse.org/technology/epp/downloads/release/helios/SR1/eclipse-php-helios-SR1-win32.zip" />
	<property name="profile" value="${buildDirectory}" />
	<property name="report_location" value="${buildDir}/api" />
	<property name="html_report_location" value="${buildDir}/api-html" />
	<target name="preFetch">
		<echo>check out org.eclipse.test to ${buildDirectory}/plugins/, because Athen expects it as source</echo>
		<cvs cvsroot=":pserver:anonymous@dev.eclipse.org:/cvsroot/eclipse" package="org.eclipse.test" dest="${buildDirectory}/plugins/" tag="v20081002" />
		<cvs cvsroot=":pserver:anonymous@dev.eclipse.org:/cvsroot/eclipse" package="org.eclipse.test" dest="${buildDirectory}/dropins/" tag="v20081002" />
		<cvs cvsroot=":pserver:anonymous@dev.eclipse.org:/cvsroot/eclipse" package="org.eclipse.ant.optional.junit" dest="${buildDirectory}/plugins/" tag="v20080717" />
	</target>

	<target name="postFetch">
		<echo>Generate PHP parser</echo>
		<antcall target="generatePhpParserFiles">
			<param name="parserGenerator" value="${buildDirectory}/plugins/org.eclipse.php.core/Resources/parserTools/build.xml" />
		</antcall>
	</target>


	<target name="checkParserGeneratorExists">
		<available property="parserGeneratorExists" file="${parserGenerator}" />
	</target>

	<!-- Generate the PHP Parser classes -->
	<target name="generatePhpParserFiles" depends="checkParserGeneratorExists,check-proxy" if="parserGeneratorExists">
		<ant antfile="${parserGenerator}" />
	</target>
	<target name="postProcess">
		<apitooling.apigeneration projectname="org.eclipse.php.core" project="${buildDirectory}/plugins/org.eclipse.php.core" binary="${buildDirectory}/plugins/org.eclipse.php.core/@dot" target="${buildDirectory}/plugins/org.eclipse.php.core" debug="true" />
		<apitooling.apigeneration projectname="org.eclipse.php.ui" project="${buildDirectory}/plugins/org.eclipse.php.ui" binary="${buildDirectory}/plugins/org.eclipse.php.ui/@dot" target="${buildDirectory}/plugins/org.eclipse.php.ui" debug="true" />
	</target>
	<target name="extraPackaging">
		<mkdir dir="${report_location}" />
		<mkdir dir="${html_report_location}" />
		<apitooling.analysis baseline="${baseline}" profile="${profile}" report="${report_location}" debug="true" excludelist="${buildDirectory}/plugins/org.eclipse.php/excludelist.txt"/>
		<apitooling.analysis_reportconversion htmlfiles="${html_report_location}" xmlfiles="${report_location}" debug="true" />
	</target>
	
	<target name="check-proxy" description="Checks that proxy properties are set before proceeding -- fails with diagnosis otherwise.">
		<setproxy proxyhost="proxy.eclipse.org" proxyport="9898" />
		<condition property="check-proxy.hostAndPortBothNotSet">
			<and>
				<not>
					<isset property="http.proxyHost" />
				</not>
				<not>
					<isset property="http.proxyPort" />
				</not>
			</and>
		</condition>
		<fail if="check-proxy.hostAndPortBothNotSet">Properties 'http.proxyHost' and 'http.proxyPort' are both not set.</fail>

		<condition property="check-proxy.hostSetOnly">
			<and>
				<isset property="http.proxyHost" />
				<not>
					<isset property="http.proxyPort" />
				</not>
			</and>
		</condition>
		<fail if="check-proxy.hostSetOnly">Property 'http.proxyHost' set to '${http.proxyHost}' but 'http.proxyPort' not set.</fail>

		<condition property="check-proxy.portSetOnly">
			<and>
				<isset property="http.proxyPort" />
				<not>
					<isset property="http.proxyHost" />
				</not>
			</and>
		</condition>
		<fail if="check-proxy.portSetOnly">Property 'http.proxyPort' set to '${http.proxyPort}' but 'http.proxyHost' not set.</fail>

		<echo>Property 'http.proxyHost' is set to '${http.proxyHost}' and property 'http.proxyPort' is set to '${http.proxyPort}'.</echo>
	</target>
	
</project>